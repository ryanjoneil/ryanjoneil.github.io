<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>üê™ Reformed JAPHs: Transpiler | adventures in optimization</title>
<meta name="keywords" content="obfuscation, python, scheme">
<meta name="description" content="Scheme to Python transpiler">
<meta name="author" content="Ryan O&#39;Neil">
<link rel="canonical" href="https://ryanjoneil.github.io/posts/2011-04-18-reformed-japhs-transpiler/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.7c3f0ab5ecc8326dc20e6644afa4081b33304fef3299b2c1179eaee195843a6a.css" integrity="sha256-fD8KtezIMm3CDmZEr6QIGzMwT&#43;8ymbLBF56u4ZWEOmo=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://ryanjoneil.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://ryanjoneil.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://ryanjoneil.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://ryanjoneil.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://ryanjoneil.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><script async data-id="101447628" src="//static.getclicky.com/js"></script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/101447628ns.gif" /></p></noscript>


<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css"
    integrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn"
    crossorigin="anonymous"/>
<script
    src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"
    integrity="sha384-cpW21h6RZv/phavutF+AuVYrr+dA8xD9zs6FwLpaCct6O9ctzYFfFr4dgmgccOTx"
    crossorigin="anonymous">
</script>

<script
    src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"
    integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
    crossorigin="anonymous"
    onload="renderMathInElement(document.body);">
</script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "$", right: "$", display: false}
        ]
    });
});
</script>

<meta property="og:title" content="üê™ Reformed JAPHs: Transpiler" />
<meta property="og:description" content="Scheme to Python transpiler" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ryanjoneil.github.io/posts/2011-04-18-reformed-japhs-transpiler/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2011-04-20T00:00:00+00:00" />
<meta property="article:modified_time" content="2011-04-20T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="üê™ Reformed JAPHs: Transpiler"/>
<meta name="twitter:description" content="Scheme to Python transpiler"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://ryanjoneil.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "üê™ Reformed JAPHs: Transpiler",
      "item": "https://ryanjoneil.github.io/posts/2011-04-18-reformed-japhs-transpiler/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "üê™ Reformed JAPHs: Transpiler",
  "name": "üê™ Reformed JAPHs: Transpiler",
  "description": "Scheme to Python transpiler",
  "keywords": [
    "obfuscation", "python", "scheme"
  ],
  "articleBody": "Note: This post was edited for clarity.\nFor the final JAPH in this series, I implemented a simple transpiler that converts a small subset of Scheme programs to equivalent Python programs. It starts with a Scheme program that prints 'just another scheme hacker'.\n(define (output x) (if (null? x) \"\" (begin (display (car x)) (if (null? (cdr x)) (display \"\\n\") (begin (display \" \") (output (cdr x))))))) (output (list \"just\" \"another\" \"scheme\" \"hacker\")) The program then tokenizes that Scheme source, parses the token stream, and converts that into Python 3.\ndef output(x): if not x: \"\" else: print(x[0], end='') if not x[1:]: print(\"\\n\", end='') else: print(\" \", end='') output(x[1:]) output([\"just\", \"another\", \"python\", \"hacker\"]) Finally it executes the resulting Python string using exec. Obfuscation is left as an exercise for the reader.\nimport re def tokenize(input): '''Tokenizes an input stream into a list of recognizable tokens''' token_res = ( r'\\(', # open paren -\u003e starts expression r'\\)', # close paren -\u003e ends expression r'\"[^\"]*\"', # quoted string (don't support \\\" yet) r'[\\w?]+' # atom ) return re.findall(r'(' + '|'.join(token_res) + ')', input) def parse(stream): '''Parses a token stream into a syntax tree''' if not stream: return [] else: # Build a list of arguments (possibly expressions) at this level args = [] while True: # Get the next token try: x = stream.pop(0) except IndexError: return args # ( and ) control the level of the tree we're at if x == '(': args.append(parse(stream)) elif x == ')': return args else: args.append(x) def compile(tree): '''Compiles an Scheme Abstract Syntax Tree into near-Python''' def compile_expr(indent, expr): indent += 1 lines = [] # these will have [(indent, statement), ...] structure while expr: # Two options: expr is a string like \"'\" or it is a list if isinstance(expr, str): return [( indent, expr.replace('scheme', 'python').replace('\\n', '\\\\n') )] else: start = expr.pop(0) if start == 'define': signature = expr.pop(0) lines.append((indent, 'def %s(%s):' % ( signature[0], ', '.join(signature[1:]) ) )) while expr: lines.extend(compile_expr(indent, expr.pop(0))) elif start == 'if': # We don't support multi-clause conditionals yet clause = compile_expr(indent, expr.pop(0))[0][1] lines.append((indent, 'if %s:' % clause)) if_true_lines = compile_expr(indent, expr.pop(0)) if_false_lines = compile_expr(indent, expr.pop(0)) lines.extend(if_true_lines) lines.append((indent, 'else:')) lines.extend(if_false_lines) elif start == 'null?': # Only supports conditionals of the form (null? foo) if isinstance(expr[0], str): condition = expr.pop(0) else: condition = compile_expr(indent, expr.pop(0))[0][1] return [(indent, 'not %s' % condition)] elif start == 'begin': # This is just a series of statements, so don't indent while expr: lines.extend(compile_expr(indent-1, expr.pop(0))) elif start == 'display': arguments = [] while expr: arguments.append( compile_expr(indent, expr.pop(0))[0][1] ) lines.append(( indent, \"print(%s, end='')\" % (', '.join(arguments)) )) elif start == 'car': lines.append((indent, '%s[0]' % expr.pop(0))) elif start == 'cdr': lines.append((indent, '%s[1:]' % expr.pop(0))) elif start == 'list': arguments = [] while expr: arguments.append( compile_expr(indent, expr.pop(0))[0][1] ) lines.append((indent, '[%s]' % ', '.join(arguments))) else: # Assume this is a function call arguments = [] while expr: arguments.append( compile_expr(indent, expr.pop(0))[0][1] ) lines.append(( indent, \"%s(%s)\" % (start, ', '.join(arguments)) )) return lines return [compile_expr(-1, expr) for expr in tree] if __name__ == '__main__': scheme = ''' (define (output x) (if (null? x) \"\" (begin (display (car x)) (if (null? (cdr x)) (display \"\\n\") (begin (display \" \") (output (cdr x))))))) (output (list \"just\" \"another\" \"scheme\" \"hacker\")) ''' python = '' for expr in compile(parse(tokenize(scheme))): python += '\\n'.join([(' ' * 4 * x[0]) + x[1] for x in expr]) + '\\n\\n' exec(python) ",
  "wordCount" : "561",
  "inLanguage": "en",
  "datePublished": "2011-04-20T00:00:00Z",
  "dateModified": "2011-04-20T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Ryan O'Neil"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://ryanjoneil.github.io/posts/2011-04-18-reformed-japhs-transpiler/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "adventures in optimization",
    "logo": {
      "@type": "ImageObject",
      "url": "https://ryanjoneil.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://ryanjoneil.github.io/" accesskey="h" title="adventures in optimization (Alt + H)">adventures in optimization</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://ryanjoneil.github.io/about" title="about">
                    <span>about</span>
                </a>
            </li>
            <li>
                <a href="https://ryanjoneil.github.io/coding" title="coding">
                    <span>coding</span>
                </a>
            </li>
            <li>
                <a href="https://ryanjoneil.github.io/posts" title="posting">
                    <span>posting</span>
                </a>
            </li>
            <li>
                <a href="https://ryanjoneil.github.io/speaking" title="speaking">
                    <span>speaking</span>
                </a>
            </li>
            <li>
                <a href="https://ryanjoneil.github.io/writing" title="writing">
                    <span>writing</span>
                </a>
            </li>
            <li>
                <a href="https://ryanjoneil.github.io/search" title="üîç">
                    <span>üîç</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      üê™ Reformed JAPHs: Transpiler
    </h1>
    <div class="post-description">
      Scheme to Python transpiler
    </div>
    <div class="post-meta"><span title='2011-04-20 00:00:00 +0000 UTC'>April 20, 2011</span>&nbsp;¬∑&nbsp;Ryan O&#39;Neil

</div>
  </header> 

  <div class="post-content"><p><em>Note: This post was edited for clarity.</em></p>
<p>For the final JAPH in this series, I implemented a simple transpiler that converts a small subset of <a href="https://www.scheme.org/">Scheme</a> programs to equivalent Python programs. It starts with a Scheme program that prints <code>'just another scheme hacker'</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scheme" data-lang="scheme"><span style="display:flex;"><span>(<span style="color:#66d9ef">define </span>(<span style="color:#a6e22e">output</span> x)
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">if </span>(null? x)
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        (<span style="color:#66d9ef">begin </span>(display (car x))
</span></span><span style="display:flex;"><span>                (<span style="color:#66d9ef">if </span>(null? (cdr x))
</span></span><span style="display:flex;"><span>                    (display <span style="color:#e6db74">&#34;\n&#34;</span>)
</span></span><span style="display:flex;"><span>                    (<span style="color:#66d9ef">begin </span>(display <span style="color:#e6db74">&#34; &#34;</span>)
</span></span><span style="display:flex;"><span>                            (<span style="color:#a6e22e">output</span> (cdr x)))))))
</span></span><span style="display:flex;"><span>(<span style="color:#a6e22e">output</span> (list <span style="color:#e6db74">&#34;just&#34;</span> <span style="color:#e6db74">&#34;another&#34;</span> <span style="color:#e6db74">&#34;scheme&#34;</span> <span style="color:#e6db74">&#34;hacker&#34;</span>))
</span></span></code></pre></div><p>The program then tokenizes that Scheme source, parses the token stream, and converts that into Python 3.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">output</span>(x):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> x:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        print(x[<span style="color:#ae81ff">0</span>], end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> x[<span style="color:#ae81ff">1</span>:]:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34; &#34;</span>, end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>            output(x[<span style="color:#ae81ff">1</span>:])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output([<span style="color:#e6db74">&#34;just&#34;</span>, <span style="color:#e6db74">&#34;another&#34;</span>, <span style="color:#e6db74">&#34;python&#34;</span>, <span style="color:#e6db74">&#34;hacker&#34;</span>])
</span></span></code></pre></div><p>Finally it executes the resulting Python string using <code>exec</code>. Obfuscation is left as an exercise for the reader.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">tokenize</span>(input):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;&#39;&#39;Tokenizes an input stream into a list of recognizable tokens&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    token_res <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;\(&#39;</span>,      <span style="color:#75715e"># open paren -&gt; starts expression</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;\)&#39;</span>,      <span style="color:#75715e"># close paren -&gt; ends expression</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;&#34;[^&#34;]*&#34;&#39;</span>, <span style="color:#75715e"># quoted string (don&#39;t support \&#34; yet)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;[\w?]+&#39;</span>   <span style="color:#75715e"># atom</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> re<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;(&#39;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;|&#39;</span><span style="color:#f92672">.</span>join(token_res) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;)&#39;</span>, input)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">parse</span>(stream):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;&#39;&#39;Parses a token stream into a syntax tree&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> stream:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Build a list of arguments (possibly expressions) at this level</span>
</span></span><span style="display:flex;"><span>        args <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Get the next token</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>                x <span style="color:#f92672">=</span> stream<span style="color:#f92672">.</span>pop(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">IndexError</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> args
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># ( and ) control the level of the tree we&#39;re at</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> x <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;(&#39;</span>:
</span></span><span style="display:flex;"><span>                args<span style="color:#f92672">.</span>append(parse(stream))
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> x <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;)&#39;</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> args
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                args<span style="color:#f92672">.</span>append(x)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">compile</span>(tree):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;&#39;&#39;Compiles an Scheme Abstract Syntax Tree into near-Python&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">compile_expr</span>(indent, expr):
</span></span><span style="display:flex;"><span>        indent <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        lines <span style="color:#f92672">=</span> [] <span style="color:#75715e"># these will have [(indent, statement), ...] structure</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> expr:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Two options: expr is a string like &#34;&#39;&#34; or it is a list</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> isinstance(expr, str):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> [(
</span></span><span style="display:flex;"><span>                    indent,
</span></span><span style="display:flex;"><span>                    expr<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;scheme&#39;</span>, <span style="color:#e6db74">&#39;python&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">n&#39;</span>)
</span></span><span style="display:flex;"><span>                )]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                start <span style="color:#f92672">=</span> expr<span style="color:#f92672">.</span>pop(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> start <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;define&#39;</span>:
</span></span><span style="display:flex;"><span>                    signature <span style="color:#f92672">=</span> expr<span style="color:#f92672">.</span>pop(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>                    lines<span style="color:#f92672">.</span>append((indent,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#39;def </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">(</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">):&#39;</span> <span style="color:#f92672">%</span> (
</span></span><span style="display:flex;"><span>                            signature[<span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#39;, &#39;</span><span style="color:#f92672">.</span>join(signature[<span style="color:#ae81ff">1</span>:])
</span></span><span style="display:flex;"><span>                        )
</span></span><span style="display:flex;"><span>                    ))
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">while</span> expr:
</span></span><span style="display:flex;"><span>                        lines<span style="color:#f92672">.</span>extend(compile_expr(indent, expr<span style="color:#f92672">.</span>pop(<span style="color:#ae81ff">0</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">elif</span> start <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;if&#39;</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e"># We don&#39;t support multi-clause conditionals yet</span>
</span></span><span style="display:flex;"><span>                    clause <span style="color:#f92672">=</span> compile_expr(indent, expr<span style="color:#f92672">.</span>pop(<span style="color:#ae81ff">0</span>))[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>                    lines<span style="color:#f92672">.</span>append((indent, <span style="color:#e6db74">&#39;if </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">:&#39;</span> <span style="color:#f92672">%</span> clause))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    if_true_lines <span style="color:#f92672">=</span> compile_expr(indent, expr<span style="color:#f92672">.</span>pop(<span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>                    if_false_lines <span style="color:#f92672">=</span> compile_expr(indent, expr<span style="color:#f92672">.</span>pop(<span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    lines<span style="color:#f92672">.</span>extend(if_true_lines)
</span></span><span style="display:flex;"><span>                    lines<span style="color:#f92672">.</span>append((indent, <span style="color:#e6db74">&#39;else:&#39;</span>))
</span></span><span style="display:flex;"><span>                    lines<span style="color:#f92672">.</span>extend(if_false_lines)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">elif</span> start <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;null?&#39;</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e"># Only supports conditionals of the form (null? foo)</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> isinstance(expr[<span style="color:#ae81ff">0</span>], str):
</span></span><span style="display:flex;"><span>                        condition <span style="color:#f92672">=</span> expr<span style="color:#f92672">.</span>pop(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                        condition <span style="color:#f92672">=</span> compile_expr(indent, expr<span style="color:#f92672">.</span>pop(<span style="color:#ae81ff">0</span>))[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> [(indent, <span style="color:#e6db74">&#39;not </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> condition)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">elif</span> start <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;begin&#39;</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e"># This is just a series of statements, so don&#39;t indent</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">while</span> expr:
</span></span><span style="display:flex;"><span>                        lines<span style="color:#f92672">.</span>extend(compile_expr(indent<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, expr<span style="color:#f92672">.</span>pop(<span style="color:#ae81ff">0</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">elif</span> start <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;display&#39;</span>:
</span></span><span style="display:flex;"><span>                    arguments <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">while</span> expr:
</span></span><span style="display:flex;"><span>                        arguments<span style="color:#f92672">.</span>append(
</span></span><span style="display:flex;"><span>                            compile_expr(indent, expr<span style="color:#f92672">.</span>pop(<span style="color:#ae81ff">0</span>))[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>                        )
</span></span><span style="display:flex;"><span>                    lines<span style="color:#f92672">.</span>append((
</span></span><span style="display:flex;"><span>                        indent,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;print(</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">, end=&#39;&#39;)&#34;</span> <span style="color:#f92672">%</span> (<span style="color:#e6db74">&#39;, &#39;</span><span style="color:#f92672">.</span>join(arguments))
</span></span><span style="display:flex;"><span>                    ))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">elif</span> start <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;car&#39;</span>:
</span></span><span style="display:flex;"><span>                    lines<span style="color:#f92672">.</span>append((indent, <span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">[0]&#39;</span> <span style="color:#f92672">%</span> expr<span style="color:#f92672">.</span>pop(<span style="color:#ae81ff">0</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">elif</span> start <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;cdr&#39;</span>:
</span></span><span style="display:flex;"><span>                    lines<span style="color:#f92672">.</span>append((indent, <span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">[1:]&#39;</span> <span style="color:#f92672">%</span> expr<span style="color:#f92672">.</span>pop(<span style="color:#ae81ff">0</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">elif</span> start <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;list&#39;</span>:
</span></span><span style="display:flex;"><span>                    arguments <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">while</span> expr:
</span></span><span style="display:flex;"><span>                        arguments<span style="color:#f92672">.</span>append(
</span></span><span style="display:flex;"><span>                            compile_expr(indent, expr<span style="color:#f92672">.</span>pop(<span style="color:#ae81ff">0</span>))[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>                        )
</span></span><span style="display:flex;"><span>                    lines<span style="color:#f92672">.</span>append((indent, <span style="color:#e6db74">&#39;[</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">]&#39;</span> <span style="color:#f92672">%</span> <span style="color:#e6db74">&#39;, &#39;</span><span style="color:#f92672">.</span>join(arguments)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e"># Assume this is a function call</span>
</span></span><span style="display:flex;"><span>                    arguments <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">while</span> expr:
</span></span><span style="display:flex;"><span>                        arguments<span style="color:#f92672">.</span>append(
</span></span><span style="display:flex;"><span>                            compile_expr(indent, expr<span style="color:#f92672">.</span>pop(<span style="color:#ae81ff">0</span>))[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>                        )
</span></span><span style="display:flex;"><span>                    lines<span style="color:#f92672">.</span>append((
</span></span><span style="display:flex;"><span>                        indent,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">(</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">)&#34;</span> <span style="color:#f92672">%</span> (start, <span style="color:#e6db74">&#39;, &#39;</span><span style="color:#f92672">.</span>join(arguments))
</span></span><span style="display:flex;"><span>                    ))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> lines
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [compile_expr(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, expr) <span style="color:#66d9ef">for</span> expr <span style="color:#f92672">in</span> tree]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    scheme <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        (define (output x)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            (if (null? x)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                (begin (display (car x))
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                       (if (null? (cdr x))
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                           (display &#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                           (begin (display &#34; &#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                                  (output (cdr x)))))))
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        (output (list &#34;just&#34; &#34;another&#34; &#34;scheme&#34; &#34;hacker&#34;))
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    python <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> expr <span style="color:#f92672">in</span> compile(parse(tokenize(scheme))):
</span></span><span style="display:flex;"><span>        python <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>join([(<span style="color:#e6db74">&#39; &#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> x[<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">+</span> x[<span style="color:#ae81ff">1</span>] <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> expr]) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>    exec(python)
</span></span></code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://ryanjoneil.github.io/tags/obfuscation/">obfuscation</a></li>
      <li><a href="https://ryanjoneil.github.io/tags/python/">python</a></li>
      <li><a href="https://ryanjoneil.github.io/tags/scheme/">scheme</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://ryanjoneil.github.io/posts/2011-04-27-affine-scaling-in-r/">
    <span class="title">¬´ Prev</span>
    <br>
    <span>üëâ Affine Scaling in R</span>
  </a>
  <a class="next" href="https://ryanjoneil.github.io/posts/2011-04-18-reformed-japhs-turing-machine/">
    <span class="title">Next ¬ª</span>
    <br>
    <span>üê™ Reformed JAPHs: Turing Machine</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://ryanjoneil.github.io/">adventures in optimization</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
